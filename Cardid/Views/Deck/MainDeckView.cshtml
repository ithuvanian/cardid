@using Cardid.Models
@model List<Deck>
@{
    ViewBag.Title = "MainDeckView";
    List<Tag> tagsByName = ViewBag.TagsByName;
    List<Tag> tagsByPopularity = ViewBag.TagsByPopularity;
    string userID = ViewBag.UserID;
    int counter = 0;
}




<div class="flex flex-center">

    <div class="deckview-left">

        @if (TempData["loginname"] != null)
        {
            <div>Thank you for logging in, @TempData["loginname"]</div>
        }

        <div class="option">

            @Html.ActionLink("Create a new deck", "CreateDeckInit", "Deck", null, new { @class = "btn main-btn" })

        </div>

        <div class="option">

            @using (Html.BeginForm("SearchDeckNames", "Deck"))
            {
                <input type="text" name="searchString" />
                <button type="submit" class="btn main-btn">Search by deck name</button>
            }
        </div>

        <div class="option">
            <h4 class="bold">Search decks by tag</h4>

            <div class="tagviews">
                <span class="tagview-pop bold">sort by popularity</span>
                <span class="tagview-alph pointer">sort alphabetically</span>
            </div>

            <div class="tag-container">

                <div class="tags-pop">

                    @foreach (Tag tag in tagsByPopularity)
                    {
                        @Html.ActionLink(tag.TagName, "SearchDeckTags", "Deck", new { searchString = tag.TagName }, new { @class = "tag active-tag" });
                    }
                </div>

                <div class="tags-alph hidden">

                    @foreach (Tag tag in tagsByName)
                    {
                        @Html.ActionLink(tag.TagName, "SearchDeckTags", "Deck", new { searchString = tag.TagName }, new { @class = "tag active-tag" });
                    }
                </div>

            </div>
            @using (Html.BeginForm("CreateTag", "Deck"))
            {
                <input type="text" name="tagName" />
                <button type="submit" class="btn main-btn">Create a new tag</button>
            }

        </div>

    </div>

    <div class="deckview-right">
        <div class="container-header">

            @if (ViewBag.SearchName != null)
            {
                if (Model.Count > 0)
                {
                    <h2 class="bold">Search results for "@ViewBag.SearchName":</h2>
                }
                else
                {
                    <h4 class="bold">No decks found matching "@ViewBag.SearchName"</h4>
                }
                @Html.ActionLink("View all decks", "Index", "Deck", null, new { @class = "btn main-btn" })
            }

            else if (ViewBag.SearchTag != null)
            {
                if (Model.Count > 0)
                {
                    <h2 style="display: inline-block">
                        Decks with tag:
                    </h2>
                    <span class="tag active-tag">@ViewBag.SearchTag</span>
                }
                else
                {
                    <h4 class="bold">
                        No decks found with the tag <span class="tag active-tag">@ViewBag.SearchTag</span>
                    </h4>
                }
                <div class="option">
                    @Html.ActionLink("View all decks", "Index", "Deck", null, new { @class = "btn main-btn" })
                </div>
            }

            else
            {
                <h1 class="view-title">All Decks</h1>
            }
        </div>

        <div class="deck-list">
            <h4 class="bold">Your decks</h4>
            @if (Model.Count > 0)
            {

                foreach (Deck deck in Model)
                {
                    if (deck.UserID == userID)
                    {
                        counter++;
                        <div class="deck-listing">
                            @Html.ActionLink(@deck.Name, "EditDeck", "Deck", new { deckID = deck.DeckID }, new { @class = "float-left" })
                            @Html.ActionLink("Study", "StudyBegin", "Deck", new { deckID = deck.DeckID }, new { @class = "btn main-btn float-right" })
                        </div>
                    }
                }
                if (counter == 0)
                {
                    if (ViewBag.SearchName != null)
                    {
                        <div>No decks matching that name.</div>
                    }
                    else if (ViewBag.SearchTag != null)
                    {
                        <div>No decks with that tag.</div>
                    }
                }
            }
            else
            {
                <div>You currently have no decks.</div>
            }
        </div>

        <div class="deck-list">

            <h4 class="bold">Public decks</h4>
            @if (Model.Count > 0)
            {

                counter = 0;
                foreach (Deck deck in Model)
                {
                    if (deck.UserID != userID)
                    {
                        counter++;
                        @Html.ActionLink(@deck.Name, "CardsInDeck", "Deck", new { deckID = deck.DeckID }, new { @class = "float-left" })
                        @Html.ActionLink("Study This Deck", "StudyBegin", "Deck", new { deckID = deck.DeckID }, new { @class = "btn main-btn float-right" })
                        <div>
                            Shared by @deck.Creator.DisplayName
                        </div>
                    }
                }
                if (counter == 0)
                {
                    if (ViewBag.SearchName != null)
                    {
                        <div>No decks matching that name.</div>
                    }
                    else if (ViewBag.SearchTag != null)
                    {
                        <div>No decks with that tag.</div>
                    }
                }
            }
            else
            {
                <div>No decks currently shared by other users.</div>
            }
        </div>

    </div>
</div>




<script type="text/javascript" src="../../Content/deckTags.js"></script>












