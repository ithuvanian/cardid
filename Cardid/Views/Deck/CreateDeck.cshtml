@using Cardid.Models
@model Deck
@{
    ViewBag.Title = "CreateDeck";
}


@if (Model.DeckName == null)
{
    <h1 class="view-title">Create Deck</h1>

    using (Html.BeginForm("CreateDeckSubmit", "Deck", new { exit = false }, FormMethod.Post, null))
    {
        <div class="module">
            @Html.Label("Name", "Enter a name for your deck: ", new { @class = "wide-label" })
            <span class="tab"></span>
            @Html.TextBoxFor(m => m.DeckName)
            <span class="tab"></span>
            <button class="btn main-btn">
                Continue
                <span class="icons">
                    &nbsp;&#xe923;
                </span>
            </button>
        </div>
    }
}
else
{
    <h2 class="view-title">
        Add Cards to Your Deck:
        <span class="large-type">
            @Model.DeckName
        </span>
    </h2>


    if (Model.Cards() != null)
    {
        foreach (Card thisCard in Model.Cards())
        {
            <div class="card-bothsides">
                <div class="card-field">@thisCard.Front</div>
                <div class="card-field">@thisCard.Back</div>
            </div>
        }
    }


    <div class="flex flex-baseline">

        @using (Html.BeginForm("CardToNewDeck", "Card", new { exit = false }, FormMethod.Post, null))
        {
            @Html.HiddenFor(m => m.DeckID, Model.DeckID)

            <div class="flex flex-baseline">
                <div class="card-bothsides">
                    <p>front of card:</p>
                    @Html.TextAreaFor(m => m.NewCardFront)
                    <p>back of card:</p>
                    @Html.TextAreaFor(m => m.NewCardBack)

                    <button class="btn main-btn">Add card to deck</button>
                </div>
            </div>
        }
    </div>

    <div class="editdeck-right module">
        @if (Model.Tags().Count > 0)
        {
            <div class="tag-container">
                <h4 class="bold at-top">Tags</h4>

                @foreach (Tag tag in Model.Tags())
                {
                    <span>
                        <span class="tag active-tag">@tag.TagName</span>
                        <a href="@Url.Action("RemoveDeckTag", "Deck", new { deckID = Model.DeckID, tagID = tag.TagID, newDeck = true })">
                            <span class="icons delete-tag">
                                &#xe904;
                            </span>
                        </a>
                        <span class="tab"></span>
                    </span>
                }
            </div>
        }

        <h4 class="bold at-top">Add Tags</h4>
        <div class="tagviews">
            <span class="bold tagview-pop">sort by popularity</span>
            <span class="pointer tagview-alph">sort alphabetically</span>
        </div>

        <div class="tag-container">
            <div class="tags-pop">

                @foreach (Tag tag in Model.OtherTagsByPopularity())
                {
                    @Html.ActionLink(tag.TagName, "AddDeckTag", "Deck", new { deckID = Model.DeckID, tagID = tag.TagID, newDeck = true }, new { @class = "tag inactive-tag" });
                }
            </div>

            <div class="tags-alph hidden">

                @foreach (Tag tag in Model.OtherTagsByName())
                {
                    @Html.ActionLink(tag.TagName, "SearchDeckTags", "Deck", new { searchString = tag.TagName, newDeck = true }, new { @class = "tag inactive-tag" });
                }
            </div>
        </div>


        <div>
            <h4 class="bold">Create a new tag for this deck:</h4>

            @using (Html.BeginForm("CreateTagForDeck", "Deck", FormMethod.Post))
            {
                @Html.TextBoxFor(m => m.NewTag.TagName)

                @Html.HiddenFor(m => Model.DeckID)

                <button type="submit" class="btn main-btn">
                    <span class="icons">
                        &#xe900;
                    </span>
                    <span class="tab"></span>
                    Add tag
                </button>
            }
        </div>
    </div>

    using (Html.BeginForm("CreateDeckSubmit", "Deck", new { exit = true }, FormMethod.Post, null))
    {
        <button type="submit" class="btn main-btn">Save deck</button>
    }

}